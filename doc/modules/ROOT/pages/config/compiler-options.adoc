= Compiler Options
:navtitle: Compiler Options

Required and optional compiler flags for building with Boost.TypeLayout.

== Required Flags

=== Standard Version

[source,bash]
----
-std=c++26    # or -std=c++2c for pre-release compilers
----

Boost.TypeLayout requires {cpp26} for P2996 static reflection support.

=== Reflection Support

[source,bash]
----
-freflection  # Enable P2996 reflection (Clang)
----

This flag enables the reflection operators and `<meta>` header.

== Recommended Flags

=== Optimization

[source,bash]
----
-O2           # Recommended for compile-time performance
-O3           # Maximum optimization
----

Higher optimization levels can significantly reduce compile times for complex type analysis.

=== Warnings

[source,bash]
----
-Wall -Wextra -Wpedantic
----

Standard warning flags work well with Boost.TypeLayout.

== Platform-Specific Flags

=== Clang (P2996 Branch)

[source,bash]
----
# Minimum required
clang++ -std=c++26 -freflection source.cpp

# Recommended
clang++ -std=c++26 -freflection -O2 -Wall -Wextra source.cpp
----

=== GCC (Future)

When GCC adds P2996 support:

[source,bash]
----
# Expected (not yet available)
g++ -std=c++26 -freflection source.cpp
----

=== MSVC (Future)

When MSVC adds P2996 support:

[source,bash]
----
# Expected (not yet available)
cl /std:c++26 /reflection source.cpp
----

== CMake Integration

=== Modern CMake

[source,cmake]
----
# CMakeLists.txt
cmake_minimum_required(VERSION 3.20)
project(my_project LANGUAGES CXX)

# Require C++26
set(CMAKE_CXX_STANDARD 26)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Compiler-specific flags
if(CMAKE_CXX_COMPILER_ID MATCHES "Clang")
    add_compile_options(-freflection)
elseif(CMAKE_CXX_COMPILER_ID MATCHES "GNU")
    # Future: add GCC reflection flag
elseif(CMAKE_CXX_COMPILER_ID MATCHES "MSVC")
    # Future: add MSVC reflection flag
endif()

# Your targets
add_executable(my_app main.cpp)
----

=== CMake Presets

[source,json]
----
{
    "version": 6,
    "configurePresets": [
        {
            "name": "clang-p2996",
            "generator": "Ninja",
            "cacheVariables": {
                "CMAKE_CXX_COMPILER": "clang++",
                "CMAKE_CXX_STANDARD": "26",
                "CMAKE_CXX_FLAGS": "-freflection"
            }
        }
    ]
}
----

== Build System Examples

=== Make

[source,makefile]
----
CXX = clang++
CXXFLAGS = -std=c++26 -freflection -O2 -Wall

%.o: %.cpp
	$(CXX) $(CXXFLAGS) -c $< -o $@

my_app: main.o
	$(CXX) $(CXXFLAGS) $^ -o $@
----

=== Meson

[source,meson]
----
project('my_project', 'cpp',
    default_options: ['cpp_std=c++26'])

add_project_arguments('-freflection', language: 'cpp')

executable('my_app', 'main.cpp')
----

=== Bazel

[source,python]
----
# .bazelrc
build --cxxopt=-std=c++26
build --cxxopt=-freflection

# BUILD
cc_binary(
    name = "my_app",
    srcs = ["main.cpp"],
)
----

== Troubleshooting

=== Error: "reflection" not recognized

[source,text]
----
error: unknown argument: '-freflection'
----

**Cause**: Your compiler doesn't support P2996 reflection.

**Solution**: Use the Clang P2996 branch:

[source,bash]
----
git clone -b p2996 https://github.com/bloomberg/clang-p2996
# Build and install
----

=== Error: <meta> header not found

[source,text]
----
fatal error: 'meta' file not found
----

**Cause**: The P2996 `<meta>` header is not available.

**Solution**: Ensure you're using a compiler with P2996 support and include paths are correct.

=== Error: constexpr evaluation limit exceeded

[source,text]
----
error: constexpr evaluation hit maximum step limit
----

**Cause**: Complex type analysis exceeds default limits.

**Solution**: Increase constexpr limits:

[source,bash]
----
-fconstexpr-steps=100000000
----

== See Also

* xref:index.adoc[Configuration Overview]
* xref:platform-support.adoc[Platform Support]
