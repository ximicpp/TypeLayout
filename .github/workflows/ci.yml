# Boost.TypeLayout CI Pipeline
#
# Multi-compiler validation for P2996 reflection support
# Primary focus: Bloomberg Clang P2996 fork (the only compiler with full support)

name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

env:
  LD_LIBRARY_PATH: /opt/p2996-toolchain/lib/x86_64-unknown-linux-gnu

jobs:
  # =========================================================================
  # Primary Build: Bloomberg Clang P2996
  # =========================================================================
  build:
    name: Clang P2996 (${{ matrix.build_type }})
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/ximicpp/typelayout-p2996:latest
    strategy:
      matrix:
        build_type: [Debug, Release]
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Configure
        run: cmake -B build -DCMAKE_BUILD_TYPE=${{ matrix.build_type }}
      
      - name: Build
        run: cmake --build build --parallel
      
      - name: Test
        run: ctest --test-dir build --output-on-failure
      
