# Boost 申请战略设计文档

## Context

TypeLayout 是一个基于 C++26 P2996 静态反射的编译时类型布局分析库。当前状态：
- 核心功能完成（Nano 架构）
- 文档已自动化部署（Antora + GitHub Pages）
- 仅 Bloomberg Clang fork 支持（P2996 未进入标准）
- 可投入时间：10-20 小时/周

## Goals

1. **决策目标**: 明确是否申请 Boost 入库，以及何时申请
2. **信息目标**: 量化收益和成本，消除决策中的模糊性
3. **风险目标**: 识别并评估关键风险，制定应对策略

## Non-Goals

- 不做详细的 Boost 申请文档（这是执行阶段的工作）
- 不做 P2996 的技术评估（已完成）
- 不比较竞品库（假设 TypeLayout 有独特价值）

---

## 收益分析 (Benefits)

### B1. 声誉收益

| 收益 | 估计价值 | 可量化性 | 备注 |
|------|----------|----------|------|
| Boost 库作者身份 | ⭐⭐⭐⭐⭐ | 主观 | 行业认可的"含金量"标志 |
| 技术演讲机会 | ⭐⭐⭐ | 中 | CppCon/C++Now 更容易接受 |
| 职业发展 | ⭐⭐⭐⭐ | 主观 | 简历亮点 |
| 开源社区影响力 | ⭐⭐⭐ | 低 | 取决于库的实际采用 |

### B2. 采用收益

| 收益 | 估计价值 | 可量化性 | 备注 |
|------|----------|----------|------|
| Boost 用户基础接触 | ⭐⭐⭐⭐ | 高 | Boost 有数百万下载 |
| 文档发现性 | ⭐⭐⭐ | 中 | boost.org 文档索引 |
| 包管理器分发 | ⭐⭐⭐⭐ | 高 | vcpkg/Conan 自动包含 |
| 标准化推动力 | ⭐⭐⭐ | 中 | 成功的 Boost 库更易进入标准 |

### B3. 技术收益

| 收益 | 估计价值 | 可量化性 | 备注 |
|------|----------|----------|------|
| 专家代码审查 | ⭐⭐⭐⭐⭐ | 高 | Formal Review 质量极高 |
| 多编译器测试基础设施 | ⭐⭐⭐⭐ | 高 | Boost CI 覆盖所有主流编译器 |
| 社区 bug 报告 | ⭐⭐⭐ | 中 | 更多用户 = 更多测试 |
| 维护协助 | ⭐⭐ | 低 | Boost 维护主要靠原作者 |

### B4. 生态收益

| 收益 | 估计价值 | 可量化性 | 备注 |
|------|----------|----------|------|
| Boost.Serialization 集成 | ⭐⭐⭐ | 中 | 自然的搭配场景 |
| Boost.Interprocess 集成 | ⭐⭐⭐ | 中 | 共享内存验证场景 |
| Boost.Asio 网络场景 | ⭐⭐ | 低 | 网络协议验证 |

---

## 成本分析 (Costs)

### C1. 时间成本（一次性）

| 任务 | 估计时间 | 复杂度 | 备注 |
|------|----------|--------|------|
| 文档转换（Markdown → AsciiDoc/Quickbook） | 40-60h | 中 | 已有 Antora 基础 |
| 测试迁移（→ Boost.Test） | 20-30h | 中 | 主要是格式调整 |
| B2 构建系统 | 15-25h | 中 | Jamfile.v2 |
| 目录结构调整 | 5-10h | 低 | 符合 Boost 约定 |
| License header 添加 | 2-4h | 低 | 所有文件 |
| **小计** | **82-129h** | - | **约 4-7 周（15h/周）** |

### C2. 时间成本（评审阶段）

| 任务 | 估计时间 | 复杂度 | 备注 |
|------|----------|--------|------|
| 邮件列表沟通 | 20-30h | 中 | 持续 2-4 周 |
| Review 响应 | 30-50h | 高 | 10 天密集期 |
| 修改和反馈 | 15-25h | 中 | Conditional Accept 情况 |
| **小计** | **65-105h** | - | **约 4-7 周（15h/周）** |

### C3. 维护成本（持续）

| 任务 | 估计时间/年 | 备注 |
|------|-------------|------|
| Issue 响应 | 20-40h | 取决于采用率 |
| Bug 修复 | 10-20h | P2996 变化相关 |
| 文档更新 | 10-15h | 每次 P2996 更新 |
| Boost 版本兼容 | 5-10h | 每季度 Boost 发布 |
| **年度小计** | **45-85h** | **约 1-2 周/年** |

### C4. 机会成本

| 替代选项 | 估计价值 | 备注 |
|----------|----------|------|
| 开发其他项目 | ⭐⭐⭐ | 约 150-230h 可用于新项目 |
| 技术演讲准备 | ⭐⭐⭐ | CppCon 演讲无需 Boost 背书 |
| 论文/博客写作 | ⭐⭐ | 技术传播不依赖 Boost |
| 独立发布维护 | ⭐⭐⭐ | GitHub + vcpkg 独立分发 |

---

## 风险矩阵 (Risk Matrix)

### R1. P2996 标准化风险

| 风险事件 | 可能性 | 影响 | 应对策略 |
|----------|--------|------|----------|
| P2996 被拒绝进入 C++26 | 15% | 🔴 致命 | 监控 WG21 进度，准备降级策略 |
| P2996 大幅修改 API | 30% | 🟡 高 | 保持抽象层，隔离 P2996 调用 |
| P2996 延迟到 C++29 | 25% | 🟡 中 | 继续支持 Bloomberg fork |
| GCC/MSVC 延迟实现 | 60% | 🟢 低 | 已预期，文档明确说明 |

**总体 P2996 风险**: 🟡 中等（不可控，但可管理）

### R2. Boost 评审风险

| 风险事件 | 可能性 | 影响 | 应对策略 |
|----------|--------|------|----------|
| Formal Review 被拒 | 20% | 🟡 中 | 先发 [interest] 邮件试探 |
| 要求大幅修改 | 40% | 🟢 低 | 正常流程，预留时间 |
| 缺乏评审者关注 | 30% | 🟡 中 | 提前在社区建立存在感 |
| 与现有库冲突（Boost.PFR） | 10% | 🟢 低 | 定位差异化 |

**总体评审风险**: 🟢 低（可控，正常流程风险）

### R3. 维护承诺风险

| 风险事件 | 可能性 | 影响 | 应对策略 |
|----------|--------|------|----------|
| 时间不足以维护 | 25% | 🟡 中 | 评估长期承诺能力 |
| 失去兴趣 | 20% | 🟡 中 | 设定明确的项目边界 |
| 用户期望过高 | 30% | 🟢 低 | 文档明确支持范围 |

**总体维护风险**: 🟡 中等（取决于个人承诺）

---

## 决策框架 (Decision Framework)

### Go/No-Go 标准

| 标准 | Go 条件 | No-Go 条件 |
|------|---------|------------|
| **P2996 进度** | 在 C++26 Draft 中或明确进入 C++29 | 被拒或无限期推迟 |
| **兴趣邮件反馈** | 正面响应 ≥ 5 人 | 负面响应主导或无响应 |
| **时间评估** | 可承诺 150-200h 一次性 + 50h/年维护 | 无法承诺 |
| **主观意愿** | 愿意成为 Boost 维护者 | 只想发布代码不想维护 |

### 分阶段评估点

```
Gate 0: 发送 [interest] 邮件 ──────────────► 评估社区反馈
                                              │
                              负面/无响应 ◄───┴───► 正面响应
                                  │                    │
                              暂缓/放弃             Gate 1
                                                       │
Gate 1: P2996 进度检查 (2026 Q1-Q2) ─────────► 评估标准化进度
                                              │
                           被拒/大改 ◄────────┴───────► 稳定进展
                                  │                    │
                              暂缓/调整            Gate 2
                                                       │
Gate 2: 时间和意愿确认 ─────────────────────► 最终决策
                                              │
                           无法承诺 ◄─────────┴───────► 确认承诺
                                  │                    │
                          独立发布策略           正式申请流程
```

### 止损条件

1. **P2996 止损**: 如果 2026 年底 P2996 仍未进入任何 C++ 标准 Working Draft，暂停 Boost 申请
2. **时间止损**: 如果准备工作超过 250h 仍未完成，重新评估
3. **社区止损**: 如果 [interest] 邮件收到 3+ 明确反对且无支持，暂缓

---

## Gate 0 反馈评估框架

### 评估时间窗口

| 阶段 | 时间 | 行动 |
|------|------|------|
| 初始反馈期 | 0-3 天 | 收集即时反应，不做判断 |
| 主要讨论期 | 3-7 天 | 积极回应问题，参与讨论 |
| 沉淀期 | 7-14 天 | 等待延迟反馈，总结分析 |
| 决策点 | 14 天后 | 综合评估，做出判断 |

### 反馈类型分类

| 类型 | 识别特征 | 权重 |
|------|----------|------|
| **明确支持** | "I would use this", "Great idea", "+1", 表示愿意参与 review | +2 |
| **条件支持** | "Interesting if...", 技术问题但态度积极 | +1 |
| **中立/观望** | 技术问题、信息请求、无明确立场 | 0 |
| **技术担忧** | 对 P2996 依赖、实现方式的合理质疑 | -1（可解决则 0）|
| **明确反对** | "Not suitable for Boost", "Already have X", 建议放弃 | -2 |

### 量化评估标准

```
反馈得分 = Σ(支持×2) + Σ(条件支持×1) + Σ(技术担忧×-1) + Σ(反对×-2)

Go:      得分 ≥ +5 且 明确支持 ≥ 3
Hold:    得分 0 ~ +4 或 响应不足
No-Go:   得分 < 0 或 明确反对 ≥ 3
```

### 关键信号识别

#### 🟢 强烈正面信号（任一出现即利好）
- Boost 核心开发者表示兴趣
- 有人主动提出愿意做 Review Manager
- 多人询问何时可以使用/测试
- 与现有 Boost 库（PFR、Serialization）维护者的积极互动

#### 🟡 需要关注的信号
- 大量关于 P2996 时间线的担忧 → 回应：明确这是探索性讨论
- 与 Boost.PFR 功能重叠的质疑 → 回应：强调差异化（布局验证 vs 字段访问）
- "等 C++26 正式发布再说" → 这是合理建议，不是反对

#### 🔴 强烈负面信号（任一出现需谨慎）
- 多位 Boost 维护者明确表示"不适合 Boost"
- 指出根本性设计缺陷（非 P2996 依赖问题）
- 完全无人响应（>7天零回复）

### 回应策略

| 反馈类型 | 回应方式 | 示例 |
|----------|----------|------|
| 技术问题 | 详细解答，展示专业性 | "Great question. The signature format..." |
| P2996 担忧 | 承认现实，展示灵活性 | "You're right that P2996 is not yet standard. This is why..." |
| 竞品比较 | 强调差异化，不贬低他人 | "Unlike X which focuses on..., TypeLayout addresses..." |
| 使用场景质疑 | 提供具体案例 | "Consider a scenario where..." |

### 反馈记录模板

```markdown
## [interest] 邮件反馈记录

发送日期: YYYY-MM-DD
邮件列表: boost-users / boost

### 响应汇总
| 日期 | 发送者 | 类型 | 摘要 | 得分 |
|------|--------|------|------|------|
| | | | | |

### 关键讨论点
1. ...

### 综合评估
- 总得分: 
- 明确支持数: 
- 明确反对数:
- **判定**: Go / Hold / No-Go

### 后续行动
- ...
```

### 无响应的处理

如果 7 天内回复 < 3 条：

1. **检查**：邮件是否成功发送、是否被归档到正确列表
2. **追问**：发送一条 follow-up，询问是否需要更多信息
3. **扩展**：考虑在其他渠道分享（Reddit r/cpp、Twitter/X）
4. **接受**：如果仍无响应，可能说明这个问题在社区关注度不高

### 时机考量

**好的发送时机**：
- 周二至周四（避开周一积压和周五离线）
- 避开主要会议期间（CppCon、C++ Now、ISO 会议周）
- 避开美国/欧洲主要假期

**当前时间评估**：2026年2月，是一个相对中性的时期，可以发送。

---

## 决策建议

### 场景分析

| 场景 | 收益期望值 | 成本期望值 | 风险调整后 ROI |
|------|------------|------------|----------------|
| **乐观**: P2996 顺利 + 评审通过 | ⭐⭐⭐⭐⭐ | 150h + 50h/年 | **高** |
| **基准**: P2996 延迟 + 评审修改 | ⭐⭐⭐⭐ | 220h + 70h/年 | **中** |
| **悲观**: P2996 大改 + 评审拒绝 | ⭐ | 100h（沉没）| **负** |
| **独立发布**: 不申请 Boost | ⭐⭐⭐ | 30h + 20h/年 | **中高** |

### 推荐策略: **分阶段试探 (Phased Exploration)**

1. **立即行动**: 发送 [interest] 邮件，成本极低（2h），收益高（获取关键反馈）
2. **等待评估**: 根据邮件反馈 + P2996 进度，决定是否进入正式准备
3. **保留退出**: 在任何 Gate 点都可以止损，转向独立发布

**理由**:
- 不需要立即决定"全押"或"放弃"
- 分阶段投入，降低沉没成本风险
- [interest] 邮件是低成本的"市场调研"

---

## Open Questions

1. [ ] 是否有 Boost 社区的熟人可以提供内部视角？
2. [ ] 是否考虑同时提交 CppCon/C++Now 演讲申请（不依赖 Boost）？
3. [ ] 如果选择独立发布，是否需要 vcpkg/Conan 打包支持？
